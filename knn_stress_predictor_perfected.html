<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prediksi Tingkat Stress - KNN + PHQ-9</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
        }
        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 20px;
            font-size: 1.1em;
        }
        .model-info {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            text-align: center;
        }
        .model-info h3 {
            margin-bottom: 10px;
            font-size: 1.3em;
        }
        .model-params {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        .param-item {
            background: rgba(255,255,255,0.2);
            padding: 10px;
            border-radius: 8px;
        }
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .form-group {
            display: flex;
            flex-direction: column;
        }
        label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 0.95em;
        }
        input[type="number"], select {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s;
        }
        input[type="number"]:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        .info {
            font-size: 0.85em;
            color: #777;
            margin-top: 4px;
        }
        button {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        button:active {
            transform: translateY(0);
        }
        .btn-reset {
            background: linear-gradient(135deg, #f5576c 0%, #f093fb 100%);
            margin-top: 15px;
        }
        .btn-use-score {
            background: linear-gradient(135deg, #49A078 0%, #5dd485 100%);
            padding: 12px;
            font-size: 1em;
            margin-top: 10px;
        }
        #result {
            margin-top: 30px;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            display: none;
            animation: slideIn 0.5s;
        }
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .result-no-stress {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            border: 3px solid #5dd485;
        }
        .result-eustress {
            background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
            border: 3px solid #ffb347;
        }
        .result-distress {
            background: linear-gradient(135deg, #ff6b6b 0%, #c92a2a 100%);
            border: 3px solid #fa5252;
        }
        .result-title {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 10px;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        .result-description {
            font-size: 1.1em;
            color: white;
            line-height: 1.6;
        }
        .emoji {
            font-size: 3em;
            margin-bottom: 10px;
        }
        .footer {
            margin-top: 30px;
            text-align: center;
            color: #999;
            font-size: 0.9em;
        }
        .phq9-result-box {
            background:#e1edfc;
            border-radius:10px;
            padding:18px;
            display:inline-block;
            margin-top:12px;
        }
        .depression-value-display {
            background: #d4edda;
            border: 2px solid #28a745;
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
            text-align: center;
            font-weight: 700;
            color: #155724;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§  Prediksi Tingkat Stress</h1>
        <p class="subtitle">Sistem Prediksi Menggunakan Algoritma K-Nearest Neighbors (KNN) + Screening PHQ-9</p>

        <div class="model-info">
            <h3>ğŸ“Š Informasi Model</h3>
            <div class="model-params">
                <div class="param-item">
                    <strong>Algorithm:</strong> KNN<br>
                    <strong>K-Neighbors:</strong> 6
                </div>
                <div class="param-item">
                    <strong>Weights:</strong> Uniform<br>
                    <strong>Metric:</strong> Manhattan
                </div>
                <div class="param-item">
                    <strong>Split Ratio:</strong> 70:30<br>
                    <strong>Accuracy:</strong> 90.61%
                </div>
                <div class="param-item">
                    <strong>Precision:</strong> 90.74%<br>
                    <strong>F1-Score:</strong> 90.63%
                </div>
            </div>
        </div>

        <form id="stressForm">
            <div class="form-grid">
                <div class="form-group">
                    <label for="mental_health_history">Riwayat Kesehatan Mental</label>
                    <select id="mental_health_history" required>
                        <option value="">-- Pilih --</option>
                        <option value="0">Tidak Ada (0)</option>
                        <option value="1">Ada (1)</option>
                    </select>
                    <span class="info">Apakah memiliki riwayat masalah kesehatan mental?</span>
                </div>
                <div class="form-group">
                  <label for="depression">Tingkat Depresi</label>
                  <select id="depression_select" required>
                    <option value="">-- Pilih Skor Depresi --</option>
                    <option value="manual">Saya tahu skor depresi saya</option>
                    <option value="phq9">Tes PHQ-9 (nggak tahu skor)</option>
                  </select>
                  <input type="number" id="depression" min="0" max="27" placeholder="Masukkan skor depresi (0-27)" style="margin-top:7px;display:none;">
                  <div id="depression_value_display" class="depression-value-display"></div>
                  <span class="info" id="depression_info">Skala 0-27 (PHQ-9: 0 = tidak, 27 = sangat tinggi)</span>
                </div>
                <div class="form-group">
                    <label for="headache">Frekuensi Sakit Kepala</label>
                    <input type="number" id="headache" min="0" max="5" required>
                    <span class="info">Skala 0-5 (0 = tidak pernah, 5 = sangat sering)</span>
                </div>
                <div class="form-group">
                    <label for="sleep_quality">Kualitas Tidur</label>
                    <input type="number" id="sleep_quality" min="0" max="5" required>
                    <span class="info">Skala 0-5 (0 = sangat buruk, 5 = sangat baik)</span>
                </div>
                <div class="form-group">
                    <label for="breathing_problem">Masalah Pernapasan</label>
                    <input type="number" id="breathing_problem" min="0" max="5" required>
                    <span class="info">Skala 0-5 (0 = tidak ada, 5 = sangat sering)</span>
                </div>
                <div class="form-group">
                    <label for="noise_level">Tingkat Kebisingan</label>
                    <input type="number" id="noise_level" min="0" max="5" required>
                    <span class="info">Skala 0-5 (0 = sangat tenang, 5 = sangat bising)</span>
                </div>
                <div class="form-group">
                    <label for="living_conditions">Kondisi Tempat Tinggal</label>
                    <input type="number" id="living_conditions" min="0" max="5" required>
                    <span class="info">Skala 0-5 (0 = sangat buruk, 5 = sangat baik)</span>
                </div>
                <div class="form-group">
                    <label for="basic_needs">Pemenuhan Kebutuhan Dasar</label>
                    <input type="number" id="basic_needs" min="0" max="5" required>
                    <span class="info">Skala 0-5 (0 = tidak terpenuhi, 5 = sangat terpenuhi)</span>
                </div>
                <div class="form-group">
                    <label for="study_load">Beban Belajar</label>
                    <input type="number" id="study_load" min="0" max="5" required>
                    <span class="info">Skala 0-5 (0 = sangat ringan, 5 = sangat berat)</span>
                </div>
                <div class="form-group">
                    <label for="social_support">Dukungan Sosial</label>
                    <input type="number" id="social_support" min="0" max="3" required>
                    <span class="info">Skala 0-3 (0 = tidak ada, 3 = sangat kuat)</span>
                </div>
            </div>
            <button type="submit">ğŸ” Prediksi Tingkat Stress dengan KNN</button>
            <button type="button" class="btn-reset" onclick="resetForm()">ğŸ”„ Mulai Ulang</button>
        </form>

        <div id="phq9_section" style="display:none;margin-top:32px;"></div>
        <div id="phq9Output" style="text-align:center;font-size:1.15em;margin-top:28px;"></div>
        <div id="result"></div>

        <div class="footer">
            K-Nearest Neighbors (k=6, Manhattan Distance) | Training Samples: 150 | Akurasi: 90.61%<br>
            + PHQ-9 Depression Screening | Â© 2025
        </div>
    </div>

<script>
// KNN Training Data (150 samples: 50 per class)
const trainingData = [{"features": [0, 5, 1, 5, 1, 1, 4, 4, 1, 3], "label": 0}, {"features": [0, 8, 1, 4, 2, 1, 3, 5, 2, 3], "label": 0}, {"features": [0, 2, 1, 5, 1, 2, 3, 5, 1, 3], "label": 0}, {"features": [0, 7, 1, 5, 2, 1, 4, 4, 2, 3], "label": 0}, {"features": [0, 7, 1, 5, 2, 1, 3, 4, 1, 3], "label": 0}, {"features": [0, 0, 1, 5, 2, 2, 3, 5, 1, 3], "label": 0}, {"features": [0, 8, 1, 4, 1, 1, 4, 5, 1, 3], "label": 0}, {"features": [1, 20, 3, 2, 0, 0, 3, 2, 5, 1], "label": 0}, {"features": [0, 8, 0, 1, 4, 3, 1, 5, 0, 1], "label": 0}, {"features": [0, 4, 1, 4, 1, 1, 3, 5, 1, 3], "label": 0}, {"features": [0, 8, 1, 5, 2, 1, 3, 5, 2, 3], "label": 0}, {"features": [0, 7, 1, 5, 1, 1, 4, 5, 1, 3], "label": 0}, {"features": [0, 2, 1, 4, 1, 1, 4, 5, 1, 3], "label": 0}, {"features": [0, 0, 1, 5, 1, 1, 3, 5, 2, 3], "label": 0}, {"features": [0, 5, 1, 4, 2, 1, 4, 4, 1, 3], "label": 0}, {"features": [0, 26, 1, 0, 4, 0, 3, 5, 1, 1], "label": 0}, {"features": [0, 6, 1, 4, 1, 1, 4, 4, 1, 3], "label": 0}, {"features": [0, 2, 1, 5, 1, 2, 4, 5, 2, 3], "label": 0}, {"features": [0, 2, 1, 5, 2, 1, 3, 5, 2, 3], "label": 0}, {"features": [0, 2, 1, 4, 2, 2, 4, 5, 2, 3], "label": 0}, {"features": [0, 3, 1, 5, 1, 2, 4, 4, 2, 3], "label": 0}, {"features": [0, 8, 1, 5, 2, 1, 4, 4, 2, 3], "label": 0}, {"features": [0, 1, 1, 4, 1, 1, 3, 5, 2, 3], "label": 0}, {"features": [0, 2, 1, 4, 1, 1, 3, 4, 2, 3], "label": 0}, {"features": [0, 3, 1, 5, 1, 2, 3, 4, 2, 3], "label": 0}, {"features": [0, 8, 1, 4, 2, 2, 4, 4, 1, 3], "label": 0}, {"features": [0, 8, 1, 5, 2, 2, 3, 4, 2, 3], "label": 0}, {"features": [0, 2, 1, 4, 1, 1, 4, 5, 2, 3], "label": 0}, {"features": [0, 4, 1, 5, 1, 1, 4, 5, 1, 3], "label": 0}, {"features": [0, 9, 4, 3, 5, 1, 3, 1, 0, 1], "label": 0}, {"features": [0, 1, 1, 4, 1, 1, 3, 5, 1, 3], "label": 0}, {"features": [0, 1, 1, 4, 1, 1, 4, 5, 2, 3], "label": 0}, {"features": [0, 8, 1, 4, 2, 2, 4, 4, 1, 3], "label": 0}, {"features": [0, 5, 1, 5, 1, 1, 4, 5, 2, 3], "label": 0}, {"features": [0, 7, 1, 5, 1, 2, 4, 5, 2, 3], "label": 0}, {"features": [0, 0, 1, 4, 1, 2, 4, 5, 1, 3], "label": 0}, {"features": [0, 4, 1, 5, 1, 2, 3, 5, 1, 3], "label": 0}, {"features": [0, 2, 1, 4, 2, 1, 3, 4, 2, 3], "label": 0}, {"features": [0, 2, 1, 5, 2, 1, 3, 5, 2, 3], "label": 0}, {"features": [1, 25, 3, 3, 4, 0, 0, 4, 5, 0], "label": 0}, {"features": [0, 8, 1, 5, 2, 1, 3, 5, 1, 3], "label": 0}, {"features": [0, 7, 1, 5, 1, 2, 4, 5, 1, 3], "label": 0}, {"features": [0, 7, 1, 4, 2, 1, 3, 5, 1, 3], "label": 0}, {"features": [0, 3, 1, 4, 1, 1, 3, 4, 1, 3], "label": 0}, {"features": [0, 8, 1, 5, 2, 2, 4, 5, 2, 3], "label": 0}, {"features": [1, 17, 5, 5, 2, 4, 0, 3, 0, 0], "label": 0}, {"features": [0, 4, 1, 4, 2, 1, 3, 5, 2, 3], "label": 0}, {"features": [0, 6, 1, 5, 2, 2, 3, 5, 1, 3], "label": 0}, {"features": [0, 0, 1, 4, 1, 1, 3, 4, 2, 3], "label": 0}, {"features": [0, 6, 1, 4, 1, 2, 4, 4, 2, 3], "label": 0}, {"features": [1, 26, 5, 0, 1, 2, 0, 0, 4, 1], "label": 1}, {"features": [0, 13, 2, 3, 4, 2, 3, 3, 3, 3], "label": 1}, {"features": [0, 13, 2, 3, 4, 2, 3, 3, 3, 3], "label": 1}, {"features": [0, 13, 2, 2, 2, 2, 2, 3, 3, 3], "label": 1}, {"features": [0, 10, 2, 3, 2, 3, 3, 2, 2, 2], "label": 1}, {"features": [0, 11, 3, 3, 4, 2, 2, 3, 3, 2], "label": 1}, {"features": [0, 13, 2, 3, 2, 3, 3, 2, 3, 2], "label": 1}, {"features": [1, 10, 3, 2, 4, 2, 3, 2, 3, 3], "label": 1}, {"features": [0, 11, 3, 3, 4, 2, 2, 2, 3, 3], "label": 1}, {"features": [0, 12, 3, 3, 4, 3, 2, 3, 2, 3], "label": 1}, {"features": [1, 11, 2, 2, 2, 3, 2, 3, 3, 3], "label": 1}, {"features": [0, 9, 3, 2, 4, 3, 3, 3, 2, 3], "label": 1}, {"features": [0, 14, 3, 3, 2, 2, 3, 3, 2, 2], "label": 1}, {"features": [1, 12, 3, 2, 4, 2, 2, 2, 3, 3], "label": 1}, {"features": [1, 10, 2, 2, 4, 2, 2, 3, 2, 3], "label": 1}, {"features": [1, 9, 2, 3, 4, 3, 2, 2, 2, 2], "label": 1}, {"features": [1, 11, 3, 3, 2, 3, 3, 2, 3, 3], "label": 1}, {"features": [1, 9, 3, 4, 0, 3, 5, 3, 5, 0], "label": 1}, {"features": [1, 12, 2, 2, 4, 3, 3, 2, 2, 3], "label": 1}, {"features": [1, 13, 2, 3, 2, 2, 3, 3, 3, 2], "label": 1}, {"features": [1, 9, 2, 2, 4, 3, 3, 2, 3, 3], "label": 1}, {"features": [0, 12, 2, 3, 4, 3, 2, 2, 3, 3], "label": 1}, {"features": [0, 9, 2, 2, 4, 2, 3, 3, 3, 2], "label": 1}, {"features": [0, 22, 0, 4, 4, 1, 1, 1, 2, 0], "label": 1}, {"features": [1, 14, 2, 2, 4, 3, 3, 3, 2, 3], "label": 1}, {"features": [1, 14, 3, 2, 2, 3, 3, 2, 2, 2], "label": 1}, {"features": [0, 19, 0, 3, 0, 3, 0, 5, 4, 0], "label": 1}, {"features": [0, 14, 2, 3, 2, 2, 2, 2, 3, 3], "label": 1}, {"features": [0, 12, 3, 3, 2, 3, 2, 2, 2, 3], "label": 1}, {"features": [1, 10, 3, 2, 2, 2, 2, 2, 2, 2], "label": 1}, {"features": [0, 12, 3, 2, 4, 3, 2, 3, 3, 2], "label": 1}, {"features": [0, 10, 4, 0, 4, 1, 3, 5, 4, 1], "label": 1}, {"features": [1, 11, 3, 3, 2, 2, 2, 3, 3, 2], "label": 1}, {"features": [1, 5, 0, 1, 0, 3, 2, 0, 1, 0], "label": 1}, {"features": [1, 13, 3, 2, 4, 3, 3, 3, 2, 2], "label": 1}, {"features": [1, 11, 3, 3, 4, 3, 2, 3, 2, 2], "label": 1}, {"features": [0, 18, 2, 3, 3, 1, 2, 4, 2, 1], "label": 1}, {"features": [0, 13, 2, 3, 4, 3, 2, 2, 2, 2], "label": 1}, {"features": [1, 10, 2, 2, 4, 3, 3, 2, 2, 3], "label": 1}, {"features": [1, 10, 3, 2, 0, 3, 4, 4, 2, 0], "label": 1}, {"features": [0, 13, 2, 2, 4, 3, 3, 2, 3, 3], "label": 1}, {"features": [1, 11, 1, 3, 4, 4, 4, 1, 5, 0], "label": 1}, {"features": [0, 21, 1, 1, 5, 4, 3, 0, 5, 0], "label": 1}, {"features": [0, 13, 3, 3, 4, 2, 2, 3, 3, 3], "label": 1}, {"features": [0, 10, 2, 2, 2, 2, 3, 2, 2, 3], "label": 1}, {"features": [0, 11, 2, 3, 4, 2, 2, 2, 2, 3], "label": 1}, {"features": [0, 6, 5, 3, 5, 3, 2, 2, 0, 1], "label": 1}, {"features": [0, 14, 3, 2, 4, 2, 2, 2, 3, 2], "label": 1}, {"features": [0, 10, 3, 3, 4, 3, 2, 3, 2, 3], "label": 1}, {"features": [0, 13, 3, 3, 4, 2, 2, 2, 2, 2], "label": 1}, {"features": [1, 23, 5, 1, 3, 5, 2, 2, 4, 1], "label": 2}, {"features": [1, 25, 3, 1, 3, 4, 1, 1, 5, 1], "label": 2}, {"features": [1, 22, 4, 1, 4, 5, 2, 2, 3, 1], "label": 2}, {"features": [0, 3, 2, 3, 1, 1, 2, 4, 1, 0], "label": 2}, {"features": [1, 18, 4, 1, 5, 4, 1, 2, 4, 1], "label": 2}, {"features": [1, 24, 3, 1, 3, 4, 2, 2, 3, 1], "label": 2}, {"features": [1, 21, 5, 1, 5, 5, 2, 1, 4, 1], "label": 2}, {"features": [1, 18, 3, 1, 5, 4, 2, 2, 5, 1], "label": 2}, {"features": [0, 5, 3, 3, 2, 5, 5, 2, 1, 1], "label": 2}, {"features": [1, 20, 3, 1, 4, 5, 1, 1, 3, 1], "label": 2}, {"features": [1, 25, 5, 1, 5, 4, 2, 2, 5, 1], "label": 2}, {"features": [1, 24, 5, 1, 4, 4, 1, 1, 5, 1], "label": 2}, {"features": [1, 17, 5, 1, 3, 4, 2, 1, 5, 1], "label": 2}, {"features": [1, 23, 3, 1, 3, 4, 2, 1, 4, 1], "label": 2}, {"features": [1, 22, 3, 1, 3, 3, 2, 1, 5, 1], "label": 2}, {"features": [1, 24, 2, 4, 2, 4, 0, 3, 3, 0], "label": 2}, {"features": [1, 15, 5, 1, 4, 3, 1, 2, 4, 1], "label": 2}, {"features": [1, 23, 5, 1, 3, 3, 2, 2, 4, 1], "label": 2}, {"features": [1, 24, 4, 1, 4, 3, 2, 1, 5, 1], "label": 2}, {"features": [1, 15, 4, 1, 3, 3, 1, 2, 4, 1], "label": 2}, {"features": [1, 26, 3, 1, 4, 4, 2, 2, 3, 1], "label": 2}, {"features": [1, 26, 5, 1, 5, 5, 2, 2, 5, 1], "label": 2}, {"features": [1, 21, 3, 1, 4, 4, 2, 2, 4, 1], "label": 2}, {"features": [0, 14, 4, 4, 5, 1, 2, 5, 1, 1], "label": 2}, {"features": [1, 24, 4, 1, 3, 4, 2, 1, 3, 1], "label": 2}, {"features": [1, 18, 4, 1, 5, 5, 1, 1, 4, 1], "label": 2}, {"features": [1, 23, 4, 1, 3, 4, 2, 1, 5, 1], "label": 2}, {"features": [1, 26, 4, 1, 4, 4, 2, 2, 5, 1], "label": 2}, {"features": [0, 1, 0, 5, 3, 4, 4, 0, 2, 1], "label": 2}, {"features": [0, 0, 4, 5, 4, 5, 1, 1, 1, 0], "label": 2}, {"features": [1, 21, 4, 1, 4, 5, 2, 2, 5, 1], "label": 2}, {"features": [1, 19, 4, 1, 5, 3, 1, 1, 4, 1], "label": 2}, {"features": [1, 20, 3, 1, 5, 5, 1, 1, 3, 1], "label": 2}, {"features": [1, 23, 4, 1, 3, 3, 2, 2, 5, 1], "label": 2}, {"features": [1, 19, 4, 1, 4, 4, 2, 2, 3, 1], "label": 2}, {"features": [1, 20, 4, 1, 4, 3, 1, 1, 4, 1], "label": 2}, {"features": [1, 27, 5, 1, 5, 5, 2, 2, 3, 1], "label": 2}, {"features": [1, 20, 3, 1, 4, 3, 1, 2, 5, 1], "label": 2}, {"features": [1, 22, 5, 1, 5, 5, 1, 1, 3, 1], "label": 2}, {"features": [1, 15, 5, 1, 3, 3, 1, 2, 5, 1], "label": 2}, {"features": [1, 20, 4, 1, 4, 5, 1, 1, 3, 1], "label": 2}, {"features": [1, 26, 3, 1, 5, 3, 2, 2, 3, 1], "label": 2}, {"features": [1, 19, 3, 1, 3, 3, 1, 2, 4, 1], "label": 2}, {"features": [1, 24, 4, 1, 5, 3, 1, 2, 5, 1], "label": 2}, {"features": [1, 18, 4, 1, 5, 4, 2, 1, 5, 1], "label": 2}, {"features": [1, 21, 5, 1, 5, 5, 2, 2, 5, 1], "label": 2}, {"features": [1, 1, 4, 0, 0, 0, 0, 4, 1, 0], "label": 2}, {"features": [1, 15, 4, 3, 3, 2, 5, 1, 2, 0], "label": 2}, {"features": [1, 22, 3, 1, 5, 5, 2, 1, 3, 1], "label": 2}, {"features": [1, 20, 3, 1, 5, 4, 2, 2, 5, 1], "label": 2}];

class KNNClassifier {
    constructor(k, metric) {
        this.k = k;
        this.metric = metric;
        this.trainingData = trainingData;
    }
    manhattanDistance(point1, point2) {
        let distance = 0;
        for (let i = 0; i < point1.length; i++) {
            distance += Math.abs(point1[i] - point2[i]);
        }
        return distance;
    }
    predict(inputFeatures) {
        const distances = this.trainingData.map(sample => {
            return {
                distance: this.manhattanDistance(inputFeatures, sample.features),
                label: sample.label
            };
        });
        distances.sort((a, b) => a.distance - b.distance);
        const kNearest = distances.slice(0, this.k);
        const votes = {};
        kNearest.forEach(neighbor => {
            votes[neighbor.label] = (votes[neighbor.label] || 0) + 1;
        });
        let maxVotes = 0;
        let predictedClass = 0;
        for (const [label, count] of Object.entries(votes)) {
            if (count > maxVotes) {
                maxVotes = count;
                predictedClass = parseInt(label);
            }
        }
        return predictedClass;
    }
}

// Handle Depression input w/ PHQ-9
const depressionSelect = document.getElementById('depression_select');
const depressionInput = document.getElementById('depression');
const depressionValueDisplay = document.getElementById('depression_value_display');
const depressionInfo = document.getElementById('depression_info');
const phq9Section = document.getElementById('phq9_section');
const phq9Output = document.getElementById('phq9Output');
let currentPHQ9Score = null;

depressionSelect.addEventListener('change', function(){
  if(this.value === 'manual'){
    depressionInput.style.display = '';
    depressionInput.required = true;
    depressionValueDisplay.style.display = 'none';
    phq9Section.style.display = 'none';
    phq9Output.style.display = 'none';
    depressionInput.value = '';
    currentPHQ9Score = null;
  } else if(this.value === 'phq9'){
    depressionInput.style.display = 'none';
    depressionInput.required = false;
    depressionValueDisplay.style.display = 'none';
    loadPHQ9Form();
    phq9Section.style.display = '';
    phq9Output.style.display = '';
    depressionInput.value = '';
    currentPHQ9Score = null;

    // Smooth scroll to PHQ-9 section
    setTimeout(() => {
      phq9Section.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }, 100);
  } else {
    depressionInput.style.display = 'none';
    depressionInput.required = false;
    depressionValueDisplay.style.display = 'none';
    phq9Section.style.display = 'none';
    phq9Output.style.display = 'none';
    depressionInput.value = '';
    currentPHQ9Score = null;
  }
});

function loadPHQ9Form() {
  phq9Section.innerHTML = `
    <div style="background: linear-gradient(110deg,#ffe57f 0%, #9AD1D4 100%); border-radius:12px; padding:32px; margin-bottom:32px;">
    <h2 style="color:#f5a623;text-align:center;margin-bottom:8px;font-size:2em;">ğŸ” Tes PHQ-9 Gen-Z!</h2>
    <p style="text-align:center; font-size:1em; color:#666; margin-bottom:20px;">
        Jawab pertanyaan di bawah sesuai perasaan kamu dalam <b>2 minggu terakhir</b>. Jujur aja ya! ğŸ’™
    </p>
    <form id="phq9Form" style="margin:28px 0;">
      <div style="display:grid;grid-template-columns:1fr;gap:15px;">
        ${phq9IndoQuestionsHTML()}
      </div>
      <button type="submit" style="margin-top:20px;background:#49A078;font-size:1em;padding:14px 22px;width:100%;">
        ğŸš€ Hitung Skor PHQ-9
      </button>
    </form>
    </div>
  `;
  const phq9Form = document.getElementById('phq9Form');
  phq9Form.addEventListener('submit', handlePHQ9Submit);
}

function phq9IndoQuestionsHTML() {
  const opts = `
    <option value="">-- Pilih --</option>
    <option value="0">Ga pernah (0)</option>
    <option value="1">Kadang (1)</option>
    <option value="2">Sering (2)</option>
    <option value="3">Tiap hari (3)</option>
  `;
  const qs = [
    "1. Gak mood ngapa-ngapain / Gak ada kesenangan?",
    "2. Sering sedih, depresi, atau hopeless?",
    "3. Susah tidur / kebanyakan tidur?",
    "4. Lemas / kurang energi sepanjang waktu?",
    "5. Nafsu makan hilang / ngemil mulu?",
    "6. Sering nyalahin diri, gagal, atau merasa useless?",
    "7. Susah fokus / gampang blank?",
    "8. Gerak lambat / jadi hiperaktif gak jelas?",
    "9. Pernah kepikiran bunuh diri atau pengen ngilang?"
  ];
  return qs.map((q, i) =>
    `<label style="font-weight:600; color:#333;">${q}<select name="q${i+1}" required style="margin-top:5px;">${opts}</select></label>`
  ).join("");
}

const genzMessages = {
  0: ["Mood kamu lagi ceria, hidup chill banget! ğŸš´â€â™‚ï¸",
      "Mental aman, ga perlu overthinking! ğŸ˜",
      "TikTok scrolling ga bikin baper sama sekali! âœ¨",
      "Kamu lagi vibes positif, pertahankan ya! ğŸŒˆ",
      "Alhamdulillah kondisi mental stabil. Keep going! ğŸ’ª"],
  1: ["Light mellow detected, healing-healing aja~ ğŸƒ",
      "Ngopi, ngobrol sama bestie itu solusi! â˜•",
      "Sedikit mellow normal kok, asal tetap semangat! ğŸ’ª",
      "Me time dikit kayaknya cocok buat kamu sekarang ğŸŒ¸",
      "Ada yang mengganggu pikiran? Sharing bisa bikin lega ğŸ—£ï¸"],
  2: ["Lumayan berat ya, tetap semangat! ğŸš‘",
      "Curhat sama orang terdekat atau journaling itu keren! ğŸ“”",
      "Jangan lupa deep talk sama diri sendiri, you deserve healing! ğŸŒ±",
      "Take your time, healing ga harus cepat kok ğŸ•Šï¸",
      "Istirahat yang cukup dan self-care is the key! ğŸ’†â€â™€ï¸"],
  3: ["Skor PHQ-9 kamu tinggi banget. Jangan ragu reach out! ğŸ’¬",
      "Bantuan itu penting, kamu penting. Self-love maksimal! ğŸ™",
      "Mental health matters, please take care and cari support kalau berat! ğŸ§‘â€ğŸ¤â€ğŸ§‘",
      "Kamu nggak sendirian, ada yang siap bantu kok ğŸ¤—",
      "Professional help itu bukan kelemahan, tapi kekuatan! ğŸ’™"]
};

function handlePHQ9Submit(e) {
  e.preventDefault();
  let score = 0, form = e.target;
  for(let i=1;i<=9;i++) score += parseInt(form['q'+i].value);
  currentPHQ9Score = score;

  let level = 0, msg = '';
  if(score <= 4) level = 0;
  else if(score <= 9) level = 1;
  else if(score <= 19) level = 2;
  else level = 3;
  let mArr = genzMessages[level];
  msg = mArr[Math.floor(Math.random()*mArr.length)];

  phq9Output.innerHTML = `
    <div class="phq9-result-box">
      <div style="font-size:1.3em; margin-bottom:10px;">
        <b>Skor PHQ-9 kamu: ${score}/27</b>
      </div>
      <div style="color:#2626e3;font-weight:700; margin-bottom:15px;">
        ${msg}
      </div>
      <button type="button" class="btn-use-score" onclick="usePhq9Score()">
        âœ… Pakai Skor Ini untuk Prediksi
      </button>
    </div>
  `;
  phq9Output.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
}

function usePhq9Score() {
  if(currentPHQ9Score !== null) {
    // Set the value
    depressionInput.value = currentPHQ9Score;

    // Show the depression value in a visible display box
    depressionValueDisplay.innerHTML = `âœ… Skor Depresi: <strong>${currentPHQ9Score}/27</strong> (dari Tes PHQ-9)`;
    depressionValueDisplay.style.display = 'block';

    // Hide PHQ-9 section and output
    phq9Section.style.display = 'none';
    phq9Output.style.display = 'none';

    // Scroll back to the form (specifically to depression field)
    setTimeout(() => {
      document.getElementById('depression_select').scrollIntoView({ behavior: 'smooth', block: 'center' });
    }, 100);
  }
}

function resetForm() {
  document.getElementById('stressForm').reset();
  depressionSelect.value = '';
  depressionInput.value = '';
  depressionInput.style.display = 'none';
  depressionValueDisplay.style.display = 'none';
  depressionValueDisplay.innerHTML = '';
  phq9Section.style.display = 'none';
  phq9Output.style.display = 'none';
  phq9Output.innerHTML = '';
  document.getElementById('result').style.display = 'none';
  currentPHQ9Score = null;
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

// Varied messages for stress prediction results
const stressMessages = {
  noStress: [
    {
      emoji: 'ğŸ˜Š',
      title: 'Tidak Ada Stress (No Stress)',
      description: 'Kondisi mental kamu oke banget! Lanjutkan gaya hidup sehat dan tetap happy. Keep it up! ğŸŒŸ'
    },
    {
      emoji: 'ğŸŒˆ',
      title: 'Tidak Ada Stress (No Stress)',
      description: 'Wah, kamu lagi dalam kondisi prima! Terus jaga keseimbangan hidup ya, dan jangan lupa berbagi kebahagiaan ke orang lain ğŸ’«'
    },
    {
      emoji: 'âœ¨',
      title: 'Tidak Ada Stress (No Stress)',
      description: 'Mental health-mu dalam kondisi baik! Pertahankan rutinitas positif yang sudah kamu lakukan selama ini. You are doing great! ğŸ‰'
    },
    {
      emoji: 'ğŸŠ',
      title: 'Tidak Ada Stress (No Stress)',
      description: 'Alhamdulillah, kondisi psikologis kamu stabil dan sehat. Terus rawat diri dengan baik dan enjoy your life! ğŸŒ¸'
    },
    {
      emoji: 'ğŸ’š',
      title: 'Tidak Ada Stress (No Stress)',
      description: 'Kamu berhasil menjaga kesehatan mental dengan baik! Continue doing what makes you happy and stay positive! ğŸŒ»'
    }
  ],
  eustress: [
    {
      emoji: 'ğŸ˜Œ',
      title: 'Eustress (Stress Positif)',
      description: 'Kamu mengalami stress yang masih bisa dikendalikan dan bahkan memotivasi. Jangan lupa balancing dan healing tipis-tipis! ğŸ’ª'
    },
    {
      emoji: 'ğŸŒ¤ï¸',
      title: 'Eustress (Stress Positif)',
      description: 'Stress level-mu masih dalam batas wajar yang justru bisa jadi motivasi! Tetap jaga keseimbangan antara kerja dan istirahat ya ğŸ§˜'
    },
    {
      emoji: 'ğŸ¯',
      title: 'Eustress (Stress Positif)',
      description: 'Kamu sedang dalam tekanan yang produktif! Channel energi ini ke hal-hal positif, tapi ingat untuk tetap self-care ğŸ’™'
    },
    {
      emoji: 'âš¡',
      title: 'Eustress (Stress Positif)',
      description: 'Tingkat stress-mu masih manageable dan bisa memicu produktivitas. Jangan lupa istirahat yang cukup dan me-time sesekali! ğŸŒ¿'
    },
    {
      emoji: 'ğŸŒŸ',
      title: 'Eustress (Stress Positif)',
      description: 'Good news! Stress yang kamu alami masih dalam kategori positif. Terus monitor kondisimu dan praktikkan relaksasi rutin ğŸ§˜â€â™€ï¸'
    }
  ],
  distress: [
    {
      emoji: 'ğŸ˜°',
      title: 'Distress (Stress Negatif)',
      description: 'Kamu mengalami tingkat stress cukup tinggi. Coba curhat ke orang terdekat atau hubungi tenaga profesional bila perlu. You matter! ğŸ’™'
    },
    {
      emoji: 'ğŸ’”',
      title: 'Distress (Stress Negatif)',
      description: 'Kondisi stress-mu perlu perhatian serius. Jangan ragu untuk mencari bantuan profesional seperti psikolog atau konselor. Kamu tidak sendirian! ğŸ¤—'
    },
    {
      emoji: 'ğŸ†˜',
      title: 'Distress (Stress Negatif)',
      description: 'Warning level tinggi terdeteksi. Sangat disarankan untuk berbicara dengan ahli kesehatan mental. Your mental health is priority! ğŸ¥'
    },
    {
      emoji: 'ğŸ’™',
      title: 'Distress (Stress Negatif)',
      description: 'Kamu sedang mengalami beban yang berat. Please reach out to someone you trust atau professional help. Healing is not a sign of weakness ğŸŒˆ'
    },
    {
      emoji: 'ğŸ«‚',
      title: 'Distress (Stress Negatif)',
      description: 'Tingkat stress-mu memerlukan intervensi. Segera hubungi layanan kesehatan mental atau hotline crisis. Remember, asking for help is brave! ğŸ’ª'
    }
  ]
};

const knnModel = new KNNClassifier(6, 'manhattan');
document.getElementById('stressForm').addEventListener('submit', function(e) {
    e.preventDefault();

    const dep = depressionInput.value;
    if(dep === '' || isNaN(dep)) {
        alert("âš ï¸ Masukkan skor depresi dulu via manual atau Tes PHQ-9!");
        return;
    }

    const features = [
        parseInt(document.getElementById('mental_health_history').value),
        parseInt(dep),
        parseInt(document.getElementById('headache').value),
        parseInt(document.getElementById('sleep_quality').value),
        parseInt(document.getElementById('breathing_problem').value),
        parseInt(document.getElementById('noise_level').value),
        parseInt(document.getElementById('living_conditions').value),
        parseInt(document.getElementById('basic_needs').value),
        parseInt(document.getElementById('study_load').value),
        parseInt(document.getElementById('social_support').value)
    ];

    const prediction = knnModel.predict(features);
    const resultDiv = document.getElementById('result');
    let resultClass, resultData;

    if (prediction === 0) {
        resultClass = 'result-no-stress';
        const randomIndex = Math.floor(Math.random() * stressMessages.noStress.length);
        resultData = stressMessages.noStress[randomIndex];
    } else if (prediction === 1) {
        resultClass = 'result-eustress';
        const randomIndex = Math.floor(Math.random() * stressMessages.eustress.length);
        resultData = stressMessages.eustress[randomIndex];
    } else {
        resultClass = 'result-distress';
        const randomIndex = Math.floor(Math.random() * stressMessages.distress.length);
        resultData = stressMessages.distress[randomIndex];
    }

    resultDiv.className = resultClass;
    resultDiv.innerHTML = `
        <div class="emoji">${resultData.emoji}</div>
        <div class="result-title">${resultData.title}</div>
        <div class="result-description">${resultData.description}</div>
    `;
    resultDiv.style.display = 'block';
    resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
});
</script>
</body>
</html>